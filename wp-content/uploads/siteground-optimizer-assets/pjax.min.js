/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */(function(a){var e,q,f,c,i,d;function F(c,d,b){return b=g(d,b),this.on('click.pjax',c,function(d){var c=b;c.container||(c=a.extend({},b),c.container=a(this).attr('data-pjax')),n(d,c)})}function n(d,k,i){var c,e,j,f,h;if(i=g(k,i),c=d.currentTarget,e=a(c),c.tagName.toUpperCase()!=='A')throw'$.fn.pjax or $.pjax.click requires an anchor element';if(d.which>1||d.metaKey||d.ctrlKey||d.shiftKey||d.altKey)return;if(location.protocol!==c.protocol||location.hostname!==c.hostname)return;if(c.href.indexOf('#')>-1&&r(c)==r(location))return;if(d.isDefaultPrevented())return;j={url:c.href,container:e.attr('data-pjax'),target:c},f=a.extend({},j,i),h=a.Event('pjax:click'),e.trigger(h,[f]),h.isDefaultPrevented()||(b(f),d.preventDefault(),e.trigger('pjax:clicked',[f]))}function y(h,i,f){var e,d,c;if(f=g(i,f),e=h.currentTarget,d=a(e),e.tagName.toUpperCase()!=='FORM')throw'$.pjax.submit requires a form element';if(c={type:(d.attr('method')||'GET').toUpperCase(),url:d.attr('action'),container:d.attr('data-pjax'),target:e},c.type!=='GET'&&window.FormData!==void 0)c.data=new FormData(e),c.processData=!1,c.contentType=!1;else{if(d.find(':file').length)return;c.data=d.serializeArray()}b(a.extend({},c,f)),h.preventDefault()}function b(c){var f,k,e,g,i;if(c=a.extend(!0,{},a.ajaxSettings,b.defaults,c),typeof c.url=='function'&&(c.url=c.url()),f=j(c.url).hash,k=typeof c.container,k!=='string')throw"expected string value for 'container' option; got "+k;if(e=c.context=a(c.container),!e.length)throw"the container selector '"+c.container+"' did not match anything";c.data||(c.data={}),Array.isArray(c.data)?c.data.push({name:'_pjax',value:c.container}):c.data._pjax=c.container;function d(f,g,b){b||(b={}),b.relatedTarget=c.target;var d=a.Event(f,b);return e.trigger(d,g),!d.isDefaultPrevented()}return c.beforeSend=function(b,a){if(a.type!=='GET'&&(a.timeout=0),b.setRequestHeader('X-PJAX','true'),b.setRequestHeader('X-PJAX-Container',c.container),!d('pjax:beforeSend',[b,a]))return!1;a.timeout>0&&(g=setTimeout(function(){d('pjax:timeout',[b,c])&&b.abort('timeout')},a.timeout),a.timeout=0);var e=j(a.url);f&&(e.hash=f),c.requestUrl=p(e)},c.complete=function(a,b){g&&clearTimeout(g),d('pjax:complete',[a,b,c]),d('pjax:end',[a,c])},c.error=function(a,b,e){var f=v('',a,c),g=d('pjax:error',[a,b,e,c]);c.type=='GET'&&b!=='abort'&&g&&h(f.url)},c.success=function(o,p,i){var r=b.state,m=typeof a.pjax.defaults.version=='function'?a.pjax.defaults.version():a.pjax.defaults.version,n=i.getResponseHeader('X-PJAX-Version'),g=v(o,i,c),k=j(g.url),q;if(f&&(k.hash=f,g.url=k.href),m&&n&&m!==n){h(g.url);return}if(!g.contents){h(g.url);return}if(b.state={id:c.id||t(),url:g.url,title:g.title,container:c.container,fragment:c.fragment,timeout:c.timeout},(c.push||c.replace)&&window.history.replaceState(b.state,g.title,g.url),q=a.contains(e,document.activeElement),q)try{document.activeElement.blur()}catch(a){}g.title&&(document.title=g.title),d('pjax:beforeReplace',[g.contents,c],{state:b.state,previousState:r}),'function'==typeof c.renderCallback?c.renderCallback(e,g.contents,l):(e.html(g.contents),l());function l(){var b=e.find('input[autofocus], textarea[autofocus]').last()[0],h,j,k;b&&document.activeElement!==b&&b.focus(),z(g.scripts),h=c.scrollTo,f&&(j=decodeURIComponent(f.slice(1)),k=document.getElementById(j)||document.getElementsByName(j)[0],k&&(h=a(k).offset().top)),typeof h=='number'&&a(window).scrollTop(h),d('pjax:success',[o,p,i,c])}},b.state||(b.state={id:t(),url:window.location.href,title:document.title,container:c.container,fragment:c.fragment,timeout:c.timeout},window.history.replaceState(b.state,document.title)),s(b.xhr),b.options=c,i=b.xhr=a.ajax(c),i.readyState>0&&(c.push&&!c.replace&&(A(b.state.id,[c.container,u(e)]),window.history.pushState(null,'',c.requestUrl)),d('pjax:start',[i,c]),d('pjax:send',[i,c])),b.xhr}function C(c,d){var e={url:window.location.href,push:!1,replace:!0,scrollTo:!1};return b(a.extend(e,g(c,d)))}function h(a){window.history.replaceState(null,'',b.state.url),window.location.replace(a)}e=!0,q=window.location.href,f=window.history.state,f&&f.container&&(b.state=f),'state'in window.history&&(e=!1);function w(p){var g,d,l,m,j,f,k,n,i,o;if(e||s(b.xhr),g=b.state,d=p.state,d&&d.container){if(e&&q==d.url)return;if(g){if(g.id===d.id)return;l=g.id<d.id?'forward':'back'}m=c[d.id]||[],j=m[0]||d.container,f=a(j),k=m[1],f.length?(g&&B(l,g.id,[j,u(f)]),n=a.Event('pjax:popstate',{state:d,direction:l}),f.trigger(n),i={id:d.id,url:d.url,container:j,push:!1,fragment:d.fragment,timeout:d.timeout,scrollTo:!1},k?(f.trigger('pjax:start',[null,i]),b.state=d,d.title&&(document.title=d.title),o=a.Event('pjax:beforeReplace',{state:d,previousState:g}),f.trigger(o,[k,i]),f.html(k),f.trigger('pjax:end',[null,i])):b(i),f[0].offsetHeight):h(location.href)}e=!1}function E(c){var g=typeof c.url=='function'?c.url():c.url,e=c.type?c.type.toUpperCase():'GET',d=a('<form>',{method:e==='GET'?'GET':'POST',action:g,style:'display:none'}),b,f;if(e!=='GET'&&e!=='POST'&&d.append(a('<input>',{type:'hidden',name:'_method',value:e.toLowerCase()})),b=c.data,typeof b=='string')a.each(b.split('&'),function(e,c){var b=c.split('=');d.append(a('<input>',{type:'hidden',name:b[0],value:b[1]}))});else if(Array.isArray(b))a.each(b,function(c,b){d.append(a('<input>',{type:'hidden',name:b.name,value:b.value}))});else if(typeof b=='object')for(f in b)d.append(a('<input>',{type:'hidden',name:f,value:b[f]}));a(document.body).append(d),d.submit()}function s(b){b&&b.readyState<4&&(b.onreadystatechange=a.noop,b.abort())}function t(){return(new Date).getTime()}function u(b){var a=b.clone();return a.find('script').each(function(){this.src||jQuery._data(this,'globalEval',!1)}),a.contents()}function p(a){return a.search=a.search.replace(/([?&])(_pjax|_)=[^&]*/g,'').replace(/^&/,''),a.href.replace(/\?($|#)/,'$1')}function j(b){var a=document.createElement('a');return a.href=b,a}function r(a){return a.href.replace(/#.*/,'')}function g(b,c){return b&&c?(c=a.extend({},c),c.container=b,c):a.isPlainObject(b)?b:{container:b}}function l(a,b){return a.filter(b).add(a.find(b))}function m(b){return a.parseHTML(b,document,!0)}function v(f,n,e){var b={},h=/<html/i.test(f),i=n.getResponseHeader('X-PJAX-URL'),g,d,k,c;return b.url=i?p(j(i)):e.requestUrl,h?(d=a(m(f.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0])),k=f.match(/<head[^>]*>([\s\S.]*)<\/head>/i),g=k!=null?a(m(k[0])):d):g=d=a(m(f)),d.length===0?b:(b.title=l(g,'title').last().text(),e.fragment?(c=d,e.fragment!=='body'&&(c=l(c,e.fragment).first()),c.length&&(b.contents=e.fragment==='body'?c:c.contents(),b.title||(b.title=c.attr('title')||c.data('title')))):h||(b.contents=d),b.contents&&(b.contents=b.contents.not(function(){return a(this).is('title')}),b.contents.find('title').remove(),b.scripts=l(b.contents,'script[src]').remove(),b.contents=b.contents.not(b.scripts)),b.title&&(b.title=a.trim(b.title)),b)}function z(b){if(!b)return;var c=a('script[src]');b.each(function(){var e=this.src,f=c.filter(function(){return this.src===e}),b,d;if(f.length)return;b=document.createElement('script'),d=a(this).attr('type'),d&&(b.type=d),b.src=a(this).attr('src'),document.head.appendChild(b)})}c={},i=[],d=[];function A(a,e){c[a]=e,d.push(a),k(i,0),k(d,b.defaults.maxCacheLength)}function B(g,a,h){var e,f;c[a]=h,g==='forward'?(e=d,f=i):(e=i,f=d),e.push(a),a=f.pop(),a&&delete c[a],k(e,b.defaults.maxCacheLength)}function k(a,b){while(a.length>b)delete c[a.shift()]}function D(){return a('meta').filter(function(){var b=a(this).attr('http-equiv');return b&&b.toUpperCase()==='X-PJAX-VERSION'}).attr('content')}function o(){a.fn.pjax=F,a.pjax=b,a.pjax.enable=a.noop,a.pjax.disable=x,a.pjax.click=n,a.pjax.submit=y,a.pjax.reload=C,a.pjax.defaults={timeout:5e3,push:!0,replace:!1,type:'GET',dataType:'html',scrollTo:0,maxCacheLength:20,version:D},a(window).on('popstate.pjax',w)}function x(){a.fn.pjax=function(){return this},a.pjax=E,a.pjax.enable=o,a.pjax.disable=a.noop,a.pjax.click=a.noop,a.pjax.submit=a.noop,a.pjax.reload=function(){window.location.reload()},a(window).off('popstate.pjax',w)}a.event.props&&a.inArray('state',a.event.props)<0?a.event.props.push('state'):'state'in a.Event.prototype||a.event.addProp('state'),a.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/),a.support.pjax?o():x()})(jQuery)