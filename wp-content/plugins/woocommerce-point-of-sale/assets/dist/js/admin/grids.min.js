"use strict";!function(a,l){var o={admin:wc_pos_params,grids:wc_pos_admin_grids_params},n={id:"#wc-pos-grid-tiles",sortable:{items:".wc-pos-grid-tile",handle:".handle",axis:"y",helper:function(i,e){var t=e.children(),e=e.clone();return e.children().each(function(i){a(this).width(t.eq(i).width())}),e},start:function(i,e){a(this).attr("data-current-index",e.item.index()+1)},update:function(i,e){var t=o.grids.grid_id,d=a(this).attr("data-current-index"),e=e.item.index()+1;a(this).removeAttr("data-current-index"),a.ajax({type:"POST",url:o.admin.ajax_url,data:{action:"wc_pos_reorder_grid_tile",security:o.grids.grid_tile_nonce,new_position:e,current_position:d,grid_id:t},beforeSend:function(){a("#grid_tiles").sortable("disable")},success:function(i){i.success?n.reloadTiles():l.alert(i.data.error),a("#grid_tiles").sortable("enable")}})}},init:function(){a(this.id).on("click","button.add-tile",this.addTile).on("click","a.delete-tile",this.deleteTile).on("click","button.delete-all-tiles",this.deleteAllTiles),a("#grid_tiles").sortable(this.sortable),a(document.body).on("wc_backbone_modal_loaded",this.backbone.init).on("wc_backbone_modal_response",this.backbone.response)},block:function(){a(this.id).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){a(this.id).unblock()},initTiptip:function(){a("#tiptip_holder").removeAttr("style"),a("#tiptip_arrow").removeAttr("style"),a(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},reloadTiles:function(){var i={grid_id:o.grids.grid_id,action:"wc_pos_load_grid_tiles",security:o.grids.grid_tile_nonce};a.ajax({url:o.admin.ajax_url,data:i,type:"POST",success:function(i){a(n.id).find(".inside").empty(),a(n.id).find(".inside").append(i.data.html),n.initTiptip(),n.unblock(),a("#grid_tiles").sortable(n.sortable)}})},addTile:function(){return a(this).WCBackboneModal({template:"wc-pos-modal-add-tile"}),a("#wc-pos-modal-add-tile").on("change"," select#tile_type",n.toggleTileType),!1},deleteTile:function(i){i.preventDefault(),l.confirm(o.grids.i18n_delete_tile)&&(n.block(),i={action:"wc_pos_delete_grid_tile",grid_id:o.grids.grid_id,tile_id:a(this).closest(".wc-pos-grid-tile").data("gridTileId"),security:o.grids.grid_tile_nonce},a.ajax({type:"POST",url:o.admin.ajax_url,data:i,success:function(i){i.success?n.reloadTiles():(n.unblock(),l.alert(i.data.error))},dataType:"json"}))},deleteAllTiles:function(i){i.preventDefault(),l.confirm(o.grids.i18n_delete_all_tiles)&&(n.block(),i={action:"wc_pos_delete_all_grid_tiles",grid_id:o.grids.grid_id,security:o.grids.grid_tile_nonce},a.ajax({type:"POST",url:o.admin.ajax_url,data:i,success:function(i){i.success?n.reloadTiles():(n.unblock(),l.alert(i.data.error))},dataType:"json"}))},toggleTileType:function(){"product_cat"===a(this).val()?(a("#wc-pos-modal-add-tile .product_id_field").hide(),a("#wc-pos-modal-add-tile .product_cat_field").show()):(a("#wc-pos-modal-add-tile .product_id_field").show(),a("#wc-pos-modal-add-tile .product_cat_field").hide())},backbone:{init:function(i,e){"wc-pos-modal-add-tile"===e&&a(document.body).trigger("wc-enhanced-select-init")},response:function(i,e,t){"wc-pos-modal-add-tile"===e&&n.backbone.add_tile(t)},add_tile:function(i){n.block();i={action:"wc_pos_add_grid_tile",grid_id:o.grids.grid_id,security:o.grids.grid_tile_nonce,data:i};a.ajax({type:"POST",url:o.admin.ajax_url,data:i,success:function(i){i.success?n.reloadTiles():(n.unblock(),l.alert(i.data.error))},dataType:"json"})}}};n.init()}(jQuery,window,document);