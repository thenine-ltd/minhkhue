"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var o,r=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!==_typeof(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}!function(s,t){var a={admin:wc_pos_params,receipts:wc_pos_admin_receipts_params},o={id:"#wc-pos-receipt-form",watchFields:['[name="name"]','[name="show_title"]','[name="title_position"]','[name="width"]','[name="logo"]','[name="logo_position"]','[name="logo_size"]','[name="outlet_details_position"]','[name="show_shop_name"]','[name="show_outlet_name"]','[name="show_outlet_address"]','[name="show_outlet_contact_details"]','[name="social_details_position"]','[name="show_social_twitter"]','[name="show_social_facebook"]','[name="show_social_instagram"]','[name="show_social_snapchat"]','[name="show_wifi_details"]','[name="show_tax_number"]','[name="tax_number_label"]','[name="tax_number_position"]','[name="show_order_status"]','[name="show_order_date"]','[name="order_date_format"]','[name="order_date_format_custom"]','[name="order_time_format"]','[name="order_time_format_custom"]','[name="show_customer_name"]','[name="show_customer_email"]','[name="show_customer_phone"]','[name="show_customer_shipping_address"]','[name="show_customer_billing_address"]','[name="show_cashier_name"]','[name="cashier_name_format"]','[name="product_details_layout"]','[name="show_register_name"]','[name="show_product_image"]','[name="show_product_sku"]','[name="show_product_cost"]','[name="show_product_discount"]','[name="show_product_original_price"]','[name="show_num_items"]','[name="show_tax_summary"]','[name="show_order_barcode"]','[name="barcode_type"]','[name="header_text"]','[name="footer_text"]','[name="text_size"]','[name="print_copies"]','[name="num_copies"]'],cachedDateFormats:{},cachedTimeFormats:{},logoUploader:null,init:function(){s(this.id).on("submit",this.submitted).on("change keyup","input, select, textarea",this.changed).on("change keyup",this.watchFields.join(","),this.updatePreview).on("change keyup",this.watchFields.join(","),this.updateOptions).on("click","#customize-control-logo button.upload",this.selectLogo).on("click","#customize-control-logo button.remove",this.removeLogo).on("click","#customize-control-logo button.upload, #customize-control-logo button.remove",this.changed).find(this.watchFields.filter(function(e){return-1===['[name="order_date_format"]','[name="order_date_format_custom"]','[name="order_time_format"]','[name="order_time_format_custom"]'].indexOf(e)}).join(",")).trigger("change"),wp.codeEditor.initialize(s("#custom_css"),{codemirror:{lineNumbers:!0,mode:"css",indentUnit:4,indentWithTabs:!0}}).codemirror.on("change",function(e){var t=JSON.parse(s("app-receipt").attr("options"));s("app-receipt").attr("options",JSON.stringify(_objectSpread(_objectSpread({},t),{},{custom_css:e.doc.getValue()}))),s("#custom_css").val(e.doc.getValue())})},validate:function(e){var t,o={},r={};return e.forEach(function(e){o[e.name]=e.value}),void 0!==o.name&&0!==o.name.trim().length||(r.name_is_empty=a.receipts.i18n_field_name_empty),void 0===o.width||0===o.width.trim().length?r.width_is_empty=a.receipts.i18n_field_width_empty:Number(o.width)<0&&(r.width_is_negative=a.receipts.i18n_field_width_negative),!(0<Object.keys(r).length&&(t=s("#customize-notifications-area"),e=s(".wp-full-overlay-sidebar-content"),t.children("ul").html(""),Object.values(r).forEach(function(e){t.children("ul").append('\n\t\t\t\t\t\t<li class="notice notice-error" data-code="client_side_error" data-type="error">\n\t\t\t\t\t\t\t<div class="notification-message">'.concat(e,"</div>\n\t\t\t\t\t\t</li>"))}),r=t.outerHeight()+1,e.css("top",45+r+"px"),1))},submitted:function(e){e.preventDefault(),s("body").addClass("saving"),o.validate(s(this).serializeArray())?(e={receipt_id:a.receipts.receipt_id,action:"wc_pos_update_receipt",data:s(this).serializeArray().reduce(function(e,t){return _objectSpread(_objectSpread({},e),{},_defineProperty({},t.name,t.value))}),security:a.receipts.update_receipt_nonce},s.ajax({url:a.admin.ajax_url,data:e,type:"POST",success:function(e){s("body").removeClass("saving"),e.success?(s(o.id).find('input[type="submit"]').prop("disabled",!0),0===a.receipts.receipt_id.length&&(t.location.href=a.admin.admin_url+"post.php?post="+e.data.id+"&action=edit")):t.alert(e.data.error)}})):s("body").removeClass("saving")},changed:function(){s(o.id).find('input[type="submit"]').prop("disabled",!1)},updatePreview:function(e){var t,e=s(e.target),o=e.attr("name"),r=e.is(":checked"),e=e.val(),a=JSON.parse(s("app-receipt").attr("data")),i=JSON.parse(s("app-receipt").attr("options"));"name"===o&&(a.shop_name=e),"show_title"===o&&(i.show_title=r),"title_position"===o&&(i.title_position=e),"print_copies"===o&&(i.print_copies=e),"num_copies"===o&&(i.num_copies=parseInt(e)),"width"===o&&(e=parseInt(e),i.width=e&&0<e&&e<=120?e:0),"logo"!==o||0!==parseInt(e)&&0!==e.length||(i.logo=null),"logo_position"===o&&(i.logo_position=e),"logo_size"===o&&(i.logo_size=e),"outlet_details_position"===o&&(i.outlet_details_position=e),"show_shop_name"===o&&(i.show_shop_name=r),"show_outlet_name"===o&&(i.show_outlet_name=r),"show_outlet_address"===o&&(i.show_outlet_address=r),"show_outlet_contact_details"===o&&(i.show_outlet_contact_details=r),"social_details_position"===o&&(i.social_details_position=e),"show_social_twitter"===o&&(i.show_social_twitter=r),"show_social_facebook"===o&&(i.show_social_facebook=r),"show_social_instagram"===o&&(i.show_social_instagram=r),"show_social_snapchat"===o&&(i.show_social_snapchat=r),"show_wifi_details"===o&&(i.show_wifi_details=r),"show_tax_number"===o&&(i.show_tax_number=r),"tax_number_label"===o&&(i.tax_number_label=e),"tax_number_position"===o&&(i.tax_number_position=e),"show_order_status"===o&&(i.show_order_status=r),"show_order_date"===o&&(i.show_order_date=r),"order_date_format"===o&&(t=s('[name="order_date_format"]:checked').val(),i.order_date_format=t?e:s('[name="order_date_format_custom"]').val()),"order_date_format_custom"===o&&""===s('[name="order_date_format"]:checked').val()&&(i.order_date_format=e),"order_time_format"===o&&(t=s('[name="order_time_format"]:checked').val(),i.order_time_format=t?e:s('[name="order_time_format_custom"]').val()),"order_time_format_custom"===o&&""===s('[name="order_time_format"]:checked').val()&&(i.order_time_format=e),"show_customer_name"===o&&(i.show_customer_name=r),"show_customer_email"===o&&(i.show_customer_email=r),"show_customer_phone"===o&&(i.show_customer_phone=r),"show_customer_shipping_address"===o&&(i.show_customer_shipping_address=r),"show_customer_billing_address"===o&&(i.show_customer_billing_address=r),"show_cashier_name"===o&&(i.show_cashier_name=r),"cashier_name_format"===o&&(i.cashier_name_format=e),"product_details_layout"===o&&(i.product_details_layout=e),"show_register_name"===o&&(i.show_register_name=r),"show_product_image"===o&&(i.show_product_image=r),"show_product_sku"===o&&(i.show_product_sku=r),"show_product_cost"===o&&(i.show_product_cost=r),"show_product_discount"===o&&(i.show_product_discount=r),"show_product_original_price"===o&&(i.show_product_original_price=r),"show_num_items"===o&&(i.show_num_items=r),"show_tax_summary"===o&&(i.show_tax_summary=r),"show_order_barcode"===o&&(i.show_order_barcode=r),"barcode_type"===o&&(i.barcode_type=e),"header_text"===o&&(i.header_text=e),"footer_text"===o&&(i.footer_text=e),"text_size"===o&&(i.text_size=e),s("app-receipt").attr("data",JSON.stringify(a)),s("app-receipt").attr("options",JSON.stringify(i))},updateOptions:function(e){var e=s(e.target),t=e.attr("name"),o=e.is(":checked"),e=e.val();"print_copies"===t&&("num_copies"!==e?s("#control_num_copies").hide():s("#control_num_copies").show()),"show_product_discount"===t&&(o?s("#control_show_product_original_price").show():s("#control_show_product_original_price").hide())},selectLogo:function(){if(!o.logoUploader)return o.logoUploader=wp.media.frames.logoUploader=wp.media({title:"Select a Receipt Logo ",button:{text:"Set Receipt Logo"},multiple:!1,library:{type:"image/png,image/jpeg"}}),o.logoUploader.on("select",function(){var e=o.logoUploader.state().get("selection").first().toJSON(),t=(s("#logo").val(e.id).trigger("change"),s("#customize-control-logo").addClass("selected"),s("#customize-control-logo .attachment-thumb").attr("src",e.url),JSON.parse(s("app-receipt").attr("options")));s("app-receipt").attr("options",JSON.stringify(_objectSpread(_objectSpread({},t),{},{logo:e.url})))}),o.logoUploader.open(),!1;o.logoUploader.open()},removeLogo:function(){return s("#logo").val("").trigger("change"),s("#customize-control-logo").removeClass("selected"),s("#customize-control-logo .attachment-thumb").attr("src",""),s("#receipt-preview .logo img").attr("src",""),!1}};o.init(),s(o.id).find("#save").prop("disabled",!1),s(".customize-pane-parent").on("click",".accordion-section-title",function(e){e.preventDefault();e=s(this).parent().attr("aria-owns"),e=s("#"+e);s(".wp-full-overlay-sidebar-content").addClass("section-open"),e.addClass("open")}),s(".customize-pane-child").on("click",".customize-section-back",function(e){s(this).parents(".customize-pane-child").removeClass("open"),s(".wp-full-overlay-sidebar-content").removeClass("section-open")})}(jQuery,window,document);